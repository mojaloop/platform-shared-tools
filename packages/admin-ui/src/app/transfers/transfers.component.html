<div class="row mb-2">
	<div class="col">
		<h3>Transfers</h3>
	</div>
	<!--<div class="col text-right">
		<button class="btn btn-warning" routerLink="/transfers/new">Create Test Transfer</button>
	</div>-->
</div>
  
<!--filter-->
<div class="filterbox">
	<form >
		<table class="table">
			<tr class="form-row">
				<div class="form-group col-md-1">
					<label for="filterState">State:</label>
					<select class="form-control" id="filterState">
						<option value="{{ALL_STR_ID}}">(All)</option>
						<option value="{{item}}" *ngFor="let item of (keywordState | async)">{{item}}</option>
					</select>
				</div>

				<div class="form-group col-md-1">
					<label for="filterCurrency">Currency:</label>
					<select class="form-control" id="filterCurrency">
						<option value="{{ALL_STR_ID}}">(All)</option>
						<option value="{{item}}" *ngFor="let item of (keywordCurrency | async)">{{item}}</option>
					</select>
				</div>

				<div class="form-group col-md-3">
					<label for="filterStartDate">Start date:</label>
					<input class="form-control" type="datetime-local" id="filterStartDate" step=300
						[ngModel]="criteriaFromDate"
						[ngModelOptions]="{standalone: true}">
				</div>


				<div class="form-group col-md-3">
					<label for="filterEndDate">End date:</label>
					<input class="form-control" type="datetime-local" id="filterEndDate" step=300>
				</div>

				<div class="form-group col-md-2">
					<label for="filterId">Id</label>
					<input class="form-control" type="text" id="filterId">
				</div>

				<div class="form-group col-md-2">
					<label for="filterBtn">&nbsp;</label>
					<button type="submit" class="form-control btn btn-primary" id="filterBtn" (click)="search()">Search &nbsp;&nbsp;<i class="bi bi-search"></i></button>
				</div>
			</tr>
		</table>
	</form>
</div>

<ng-container *ngIf="(transfers | async)?.length==0 else listTransfers">
	<div class="alert alert-warning" role="alert">
	  No transfers found.
	</div>
</ng-container>

  
<ng-template #listTransfers>
	<div>
		<table class="table">
			<thead class="thead-light">
			<tr>
				<th scope="col">Timestamp</th>
				<th scope="col">Transfer ID</th>
				<th scope="col">Payer FSP</th>
				<th scope="col">Payee FSP</th>
				<th scope="col">Transfer State</th>
				<th scope="col">Amount</th>
				<th scope="col">Currency</th>
			</tr>
			</thead>
			<tbody>
			<tr *ngFor="let item of (transfers | async)">
				<td >{{item.updatedAt | date: 'medium'}}</td>
				<td><a routerLink="/transfers/{{item.transferId}}">{{item.transferId}}</a></td>
				<td><a routerLink="/participants/{{item.payerFspId}}">{{item.payerFspId}}</a></td>
				<td><a routerLink="/participants/{{item.payeeFspId}}">{{item.payeeFspId}}</a></td>

				<td *ngIf="item.transferState==='COMMITTED'" class="text-success">{{item.transferState}}</td>
				<td *ngIf="item.transferState==='RESERVED'" class="text-warning">{{item.transferState}}</td>
				<td *ngIf="item.transferState!=='RESERVED' && item.transferState!=='COMMITTED'" class="text-danger">{{item.transferState}}</td>

				<td>{{item.amount}}</td>
				<td>{{item.currencyCode}}</td>
			</tr>
			</tbody>
		</table>
	</div>



	<!--pagination
	TODO: put in component
	-->
	<hr>
	<nav aria-label="Page navigation"  *ngIf="paginateResult | async; let paginateObj">
		<ul class="pagination justify-content-end">
			<li class="page-item" [ngClass]="{'disabled' : paginateObj.prev == null}">
				<a class="page-link" aria-label="Previous" (click)="search(paginateObj.prev ? paginateObj.prev-1 : 0)">
					<span aria-hidden="true">&laquo;</span>
					<span class="sr-only">Previous</span>
				</a>
			</li>

			<ng-container *ngFor="let item of paginateObj.items">
				<li class="page-item" *ngIf="item != null" [ngClass]="{'active' : item === paginateObj.current}">
					<a class="page-link" (click)="search(item-1)" >{{item}}
						<span class="sr-only" *ngIf="item === paginateObj.current">(current)</span>
					</a>
				</li>
				<li class="page-item disabled" *ngIf="item == null">
					<a class="page-link disabled" *ngIf="!item" >...</a>
				</li>
			</ng-container>

			<li class="page-item"  [ngClass]="{'disabled' : paginateObj.next == null}">
				<a class="page-link" aria-label="Next" (click)="search(paginateObj.next ? paginateObj.next-1 : 0)">
					<span aria-hidden="true">&raquo;</span>
					<span class="sr-only">Next</span>
				</a>
			</li>
		</ul>
	</nav>
</ng-template>